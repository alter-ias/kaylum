<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diagnóstico de Tipografía</title>
    <link rel="icon" href="data:,">
    <style>
        @font-face {
            font-family: 'MiTipografia';
            /* Asegúrate de que esta ruta es 100% correcta */
            src: url('assets/fuentes/tipo250.ttf') format('truetype');
        }
        
        body, html {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: white;
            font-family: sans-serif;
        }

        /* --- Panel de Diagnóstico --- */
        #diagnostico {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #000;
            border: 1px solid #444;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            color: #0f0;
            z-index: 100;
        }
        #diagnostico .error {
            color: #f00;
            font-weight: bold;
        }

        /* --- Prueba A: HTML puro --- */
        #prueba-html {
            font-family: 'MiTipografia', sans-serif; /* Usa tu fuente */
            font-size: 80px;
            text-align: center;
            color: #ccc;
            margin-top: 100px;
        }

        /* --- Prueba B: Canvas --- */
        #canvas-prueba {
            display: block;
            margin: 50px auto;
            background-color: #111;
            border: 1px dashed #555;
        }
    </style>
</head>
<body>

    <div id="diagnostico">Iniciando diagnóstico...</div>

    <h1 id="prueba-html">prueba 250 (HTML)</h1>
    
    <canvas id="canvas-prueba" width="800" height="200"></canvas>

    <script>
    // Envolvemos todo para que se ejecute cuando la página esté lista.
    window.onload = function() {
        const panel = document.getElementById('diagnostico');
        let logCount = 1;

        // Función para escribir en nuestro panel de diagnóstico en pantalla.
        function log(message, isError = false) {
            const p = document.createElement('p');
            p.textContent = `${logCount++}: ${message}`;
            if (isError) {
                p.className = 'error';
            }
            panel.appendChild(p);
            // También lo mostramos en la consola del navegador.
            isError ? console.error(message) : console.log(message);
        }

        log("Página cargada. Iniciando script.");

        try {
            // --- PASO 1: Encontrar el canvas ---
            const canvas = document.getElementById('canvas-prueba');
            if (!canvas) {
                log("ERROR: No se encontró el elemento canvas con id 'canvas-prueba'.", true);
                return;
            }
            log("Canvas encontrado.");

            // --- PASO 2: Obtener el contexto 2D ---
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                log("ERROR: No se pudo obtener el contexto 2D del canvas.", true);
                return;
            }
            log("Contexto 2D obtenido.");

            // --- PASO 3: Cargar la fuente con la API de JavaScript ---
            const fontName = 'MiTipografia';
            const fontUrl = 'assets/fuentes/tipo250.ttf';
            const font = new FontFace(fontName, `url(${fontUrl})`);
            log(`Intentando cargar la fuente '${fontName}' desde '${fontUrl}'...`);

            font.load().then(function(loadedFont) {
                log("ÉXITO: La fuente se ha cargado en memoria correctamente.");
                document.fonts.add(loadedFont);
                log("Fuente añadida al documento.");

                // --- PASO 4: Dibujar en el canvas ---
                const texto = 'prueba 250 (Canvas)';
                const fontSize = 80;
                
                // Limpiar el canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Configurar el estilo del texto
                ctx.fillStyle = '#00ffff'; // Un color cian brillante para que se vea bien
                ctx.font = `${fontSize}px ${fontName}`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                log(`Intentando dibujar texto con la fuente: '${ctx.font}'`);
                
                // Dibujar el texto
                ctx.fillText(texto, canvas.width / 2, canvas.height / 2);
                
                log("¡Comando de dibujo ejecutado! Si ves el texto cian, todo ha funcionado.");

            }).catch(function(error) {
                log(`ERROR FATAL: No se pudo cargar el archivo de la fuente.`, true);
                log(`Error: ${error}`, true);
                log("Verifica que la ruta 'assets/fuentes/tipo250.ttf' es correcta y el archivo no está corrupto.", true);
            });

        } catch (e) {
            log(`ERROR INESPERADO EN EL SCRIPT: ${e}`, true);
        }
    };
    </script>

</body>
</html>
